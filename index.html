<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HoltonRenov Planner â€” Holton Konstruksi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #FFC107; /* Kuning */
      --primary-dark: #E0A800;
      --secondary: #212121; /* Hitam */
      --success: #4CAF50; /* Hijau */
      --danger: #F44336; /* Merah */
      --info: #2196F3; /* Biru */
      --light: #f8f9fa;
      --dark: #212121;
      --gray: #6c757d;
      --light-gray: #f5f5f5;
      --white: #ffffff;
    }
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body { 
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%); 
      color: var(--dark); 
      padding: 15px; 
      line-height: 1.6;
      min-height: 100vh;
    }
    .container { 
      max-width: 1000px; 
      margin: 0 auto; 
      background: var(--white); 
      padding: 30px; 
      border-radius: 12px; 
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      position: relative;
      overflow: hidden;
    }
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 8px;
      height: 100%;
      background: var(--primary);
    }
    header { 
      background: var(--secondary);
      color: var(--white);
      padding: 25px 30px; 
      margin: -30px -30px 30px -30px;
      position: relative;
      text-align: center;
    }
    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    .logo img {
      height: 60px;
      margin-right: 15px;
    }
    .logo-text {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    h1 { 
      color: var(--white); 
      font-size: 32px; 
      margin-bottom: 5px;
      font-weight: 700;
    }
    .tagline {
      font-size: 14px;
      color: var(--primary);
      font-weight: 500;
    }
    h2, h3, h4 { 
      margin: 20px 0 15px; 
      color: var(--secondary);
      font-weight: 600;
    }
    h2 {
      font-size: 24px;
      display: flex;
      align-items: center;
    }
    h2 i {
      margin-right: 10px;
      color: var(--primary);
    }
    p.subtitle { 
      color: var(--white); 
      font-size: 16px; 
      margin-bottom: 20px;
      max-width: 80%;
      margin-left: auto;
      margin-right: auto;
    }
    label { 
      display: block; 
      margin: 15px 0 8px; 
      font-weight: 600; 
      font-size: 15px;
      color: var(--secondary);
    }
    input, select, textarea { 
      width: 100%; 
      padding: 12px 15px; 
      margin-bottom: 15px; 
      border: 1px solid #ddd; 
      border-radius: 8px; 
      font-size: 15px;
      transition: all 0.3s ease;
    }
    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border-color: var(--primary); 
      box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
    }
    .input-group {
      position: relative;
    }
    .input-prefix {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-weight: 600;
    }
    .input-with-prefix {
      padding-left: 35px;
    }
    .checkbox-group { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 15px; 
      margin: 15px 0;
    }
    .checkbox-item { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      font-size: 15px;
      background: var(--light-gray);
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    .checkbox-item:hover {
      background: #e0e0e0;
    }
    .checkbox-item input[type="checkbox"] {
      width: auto;
      margin-bottom: 0;
    }
    .btn-group { 
      display: flex; 
      gap: 12px; 
      margin-top: 25px; 
      flex-wrap: wrap;
    }
    .btn { 
      padding: 12px 24px; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      font-weight: 600; 
      font-size: 15px; 
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn i {
      margin-right: 8px;
    }
    .btn-hitung { 
      background: var(--primary); 
      color: var(--secondary); 
    }
    .btn-hitung:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-reset { 
      background: var(--danger); 
      color: var(--white); 
    }
    .btn-reset:hover {
      background: #d32f2f;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-save { 
      background: var(--success); 
      color: var(--white); 
    }
    .btn-save:hover {
      background: #388E3C;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-load { 
      background: var(--secondary); 
      color: var(--white); 
    }
    .btn-load:hover {
      background: #424242;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-print {
      background: var(--info);
      color: var(--white);
    }
    .btn-print:hover {
      background: #0d8aee;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-email {
      background: var(--gray);
      color: var(--white);
    }
    .btn-email:hover {
      background: #5a6268;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-share {
      background: var(--primary);
      color: var(--secondary);
    }
    .btn-share:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-add {
      background: var(--success);
      color: var(--white);
    }
    .btn-add:hover {
      background: #388E3C;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-delete {
      background: var(--danger);
      color: var(--white);
    }
    .btn-delete:hover {
      background: #d32f2f;
    }
    .result-box { 
      background: var(--light-gray); 
      padding: 25px; 
      border-radius: 10px; 
      margin-top: 25px; 
      border-left: 4px solid var(--primary);
    }
    .expense-row { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 15px; 
      align-items: end;
    }
    .expense-row input { 
      flex: 1; 
    }
    .expense-row .date-input {
      flex: 0.8;
    }
    .expense-row .amount-input {
      flex: 0.8;
    }
    .btn-remove { 
      background: var(--danger); 
      color: var(--white); 
      border: none; 
      border-radius: 6px; 
      padding: 8px 12px; 
      cursor: pointer; 
      font-size: 14px;
      transition: all 0.2s ease;
    }
    .btn-remove:hover {
      background: #d32f2f;
    }
    .toggle { 
      display: inline-block; 
      position: relative; 
      width: 62px; 
      height: 32px; 
      margin-left: 8px; 
    }
    .toggle input { 
      opacity: 0; 
      width: 0; 
      height: 0; 
    }
    .slider { 
      position: absolute; 
      cursor: pointer; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0; 
      background-color: #ccc; 
      transition: .4s; 
      border-radius: 32px; 
    }
    .slider:before { 
      position: absolute; 
      content: ""; 
      height: 24px; 
      width: 24px; 
      left: 4px; 
      bottom: 4px; 
      background-color: white; 
      transition: .4s; 
      border-radius: 50%; 
    }
    input:checked + .slider { 
      background-color: var(--success); 
    }
    input:checked + .slider:before { 
      transform: translateX(30px); 
    }
    ul { 
      padding-left: 24px; 
      margin: 12px 0; 
    }
    li { 
      margin-bottom: 8px; 
    }
    .highlight { 
      background: #fff8e1; 
      padding: 15px; 
      border-radius: 8px; 
      margin: 16px 0; 
      border-left: 4px solid var(--primary);
    }
    .highlight-info { 
      background: #e8f4fc; 
      border-left: 4px solid var(--primary); 
      padding: 20px; 
      border-radius: 8px; 
      margin-top: 20px; 
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin: 16px 0; 
    }
    th, td { 
      border: 1px solid #dfe6f0; 
      padding: 12px; 
      text-align: left; 
    }
    th { 
      background-color: var(--light-gray); 
      color: var(--secondary);
      font-weight: 600;
    }
    .section { 
      margin-bottom: 30px; 
      padding: 20px;
      border-radius: 8px;
      background: var(--white);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    footer { 
      background: var(--secondary);
      color: var(--white);
      padding: 25px 30px; 
      margin: 30px -30px -30px -30px;
      text-align: center; 
      font-size: 14px; 
      border-top: 1px solid var(--light-gray);
    }
    .footer-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    .footer-logo img {
      height: 40px;
      margin-right: 10px;
    }
    .footer-address {
      font-size: 14px;
      margin-bottom: 10px;
    }
    .footer-contact {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }
    .footer-contact a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    .footer-contact a:hover {
      text-decoration: underline;
    }
    .project-controls { 
      display: flex; 
      gap: 12px; 
      margin-top: 15px; 
      flex-wrap: wrap; 
    }
    .project-controls input { 
      margin-bottom: 0; 
    }
    a { 
      color: var(--primary); 
      text-decoration: none;
      font-weight: 500;
    }
    a:hover {
      text-decoration: underline;
    }
    .btn-add {
      background: var(--gray);
      color: var(--white);
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      margin-bottom: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
    }
    .btn-add i {
      margin-right: 8px;
    }
    .btn-add:hover {
      background: #5a6268;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .efficiency-mode {
      background: linear-gradient(135deg, #f8fff5 0%, #e8f5e9 100%);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #c8e6c9;
      margin-bottom: 25px;
    }
    .efficiency-mode h3 {
      color: var(--success);
      display: flex;
      align-items: center;
    }
    .efficiency-mode h3 i {
      margin-right: 10px;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--secondary);
      color: var(--white);
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--light-gray);
      border-top: 5px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .tab-container {
      margin-bottom: 25px;
    }
    .tab-buttons {
      display: flex;
      border-bottom: 1px solid var(--light-gray);
    }
    .tab-button {
      padding: 12px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: var(--gray);
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }
    .tab-button.active {
      color: var(--primary);
      border-bottom: 3px solid var(--primary);
    }
    .tab-content {
      display: none;
      padding: 20px 0;
    }
    .tab-content.active {
      display: block;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--light-gray);
      border-radius: 4px;
      margin: 15px 0;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: var(--primary);
      width: 0;
      transition: width 0.5s ease;
    }
    .card {
      background: var(--white);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      border-left: 4px solid var(--primary);
    }
    .card h3 {
      margin-top: 0;
      color: var(--secondary);
    }
    .tooltip {
      position: relative;
      display: inline-block;
      margin-left: 5px;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: var(--secondary);
      color: var(--white);
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 14px;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    .expense-summary {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .summary-item {
      text-align: center;
      padding: 15px;
      border-radius: 8px;
      background: var(--light-gray);
      flex: 1;
      margin: 0 5px;
    }
    .summary-item h4 {
      margin: 0 0 5px;
      font-size: 14px;
      color: var(--gray);
    }
    .summary-item p {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary);
    }
    .summary-item.positive p {
      color: var(--success);
    }
    .summary-item.negative p {
      color: var(--danger);
    }
    .expense-filter {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .expense-filter select {
      margin-bottom: 0;
      flex: 1;
    }
    .expense-chart {
      height: 300px;
      margin: 20px 0;
    }
    .chart-container {
      position: relative;
      height: 100%;
      width: 100%;
    }
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      h1 {
        font-size: 24px;
      }
      h2 {
        font-size: 20px;
      }
      .btn-group {
        flex-direction: column;
      }
      .btn {
        width: 100%;
      }
      .expense-row {
        flex-direction: column;
        gap: 10px;
      }
      .expense-row input {
        margin-bottom: 10px;
      }
      .expense-summary {
        flex-direction: column;
      }
      .summary-item {
        margin: 5px 0;
      }
    }
    @media print {
      body { padding: 0; }
      .container { 
        box-shadow: none; 
        padding: 20px;
      }
      .tab-buttons, .btn-group, .toast, .loading {
        display: none !important;
      }
      .tab-content {
        display: block !important;
      }
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
  </div>
  
  <div class="toast" id="toast"></div>

  <div class="container">
    <header>
      <div class="logo">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgNPL3ZgAJz7HXpVB6-VcD0HW2TD_A4p90rfOJ-xiHwg7Y4RfIub8s0zVwnMyr3NdsECVBrK6FsJeFaVbQI60QBVFFusJtWFWkl7PtpDuJyUSPNixW9YIiWbmB599VyLQpEvL0tliJZWPdzKTWMdEpqFwOQKENZYkfW1yJDcP-Ph35zCav6Tu12r3KcVCzH/s500/HOLTON%20(1).png" alt="Holton Logo">
        <div class="logo-text">
          <h1>HoltonRenov Planner</h1>
          <div class="tagline">Solusi Perencanaan Renovasi Terpercaya</div>
        </div>
      </div>
      <p class="subtitle">Alat Perencanaan Renovasi Rumah 36mÂ² â€” <strong>Holton Konstruksi</strong></p>
      <p><em>Mulai dari atap ke lantai, dari dalam ke luar, dengan estimasi biaya & manajemen tukang terintegrasi.</em></p>
    </header>

    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="openTab(event, 'project-tab')">
          <i class="fas fa-folder"></i> Proyek
        </button>
        <button class="tab-button" onclick="openTab(event, 'data-tab')">
          <i class="fas fa-database"></i> Data
        </button>
        <button class="tab-button" onclick="openTab(event, 'pekerjaan-tab')">
          <i class="fas fa-tools"></i> Pekerjaan
        </button>
        <button class="tab-button" onclick="openTab(event, 'tukang-tab')">
          <i class="fas fa-users"></i> Tukang
        </button>
        <button class="tab-button" onclick="openTab(event, 'pengeluaran-tab')">
          <i class="fas fa-money-bill-wave"></i> Pengeluaran
        </button>
        <button class="tab-button" onclick="openTab(event, 'hasil-tab')">
          <i class="fas fa-chart-bar"></i> Hasil
        </button>
      </div>

      <div id="project-tab" class="tab-content active">
        <!-- Simpan/Muat Proyek -->
        <div class="section">
          <h2><i class="fas fa-folder"></i> Manajemen Proyek</h2>
          <label>Nama Proyek</label>
          <input type="text" id="nama-proyek" placeholder="Contoh: Renov Rumah Pak Budi">
          <div class="project-controls">
            <button class="btn btn-save" onclick="simpanProyek()">
              <i class="fas fa-save"></i> Simpan Proyek
            </button>
            <button class="btn btn-load" onclick="muatProyek()">
              <i class="fas fa-folder-open"></i> Muat Proyek
            </button>
            <select id="daftar-proyek" style="flex:1; margin-bottom:0;"></select>
          </div>
        </div>
      </div>

      <div id="data-tab" class="tab-content">
        <!-- Data Proyek -->
        <div class="section">
          <h2><i class="fas fa-database"></i> Data Proyek</h2>
          <label>Lokasi</label>
          <select id="lokasi">
            <option value="jakarta">Jakarta</option>
            <option value="bandung">Bandung</option>
            <option value="surabaya">Surabaya</option>
            <option value="medan">Medan</option>
            <option value="semarang">Semarang</option>
            <option value="custom">Lainnya</option>
          </select>
          <div id="custom-lokasi" style="display:none;">
            <label>Kota/Provinsi</label>
            <input type="text" id="lokasi-custom" placeholder="Contoh: Yogyakarta">
          </div>
          <label>Luas Bangunan (mÂ²)</label>
          <input type="number" id="luas" value="36" min="20" max="100">
          <label>Luas Teras/Kanopi (mÂ²)</label>
          <input type="number" id="luas-kanopi" placeholder="Opsional" min="0">
          <label>Luas Taman (mÂ²)</label>
          <input type="number" id="luas-taman" placeholder="Opsional" min="0">
          <label>Panjang Pagar (meter)</label>
          <input type="number" id="panjang-pagar" value="15" min="5">
          <label>Durasi Rencana (hari kerja)</label>
          <input type="number" id="durasi" value="40" min="7">
        </div>
      </div>

      <div id="pekerjaan-tab" class="tab-content">
        <!-- Pekerjaan -->
        <div class="section">
          <h2><i class="fas fa-tools"></i> Pekerjaan yang Direnovasi</h2>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="atap">
              <label for="atap">Atap / Kebocoran</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="plumbing">
              <label for="plumbing">Plumbing & Saluran Air</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="listrik">
              <label for="listrik">Kelistrikan</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="plafond">
              <label for="plafond">Plafond</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="dinding">
              <label for="dinding">Dinding</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="kusen">
              <label for="kusen">Kusen & Roster</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="lantai">
              <label for="lantai">Lantai Keramik</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="kanopi">
              <label for="kanopi">Teras / Kanopi</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="taman">
              <label for="taman">Taman</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="pagar">
              <label for="pagar">Pagar & Gerbang</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="cat">
              <label for="cat">Pengecatan Akhir</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="lengkong">
              <label for="lengkong">Paket Lengkap</label>
            </div>
          </div>
        </div>

        <!-- Mode Efisiensi -->
        <div class="efficiency-mode">
          <h3><i class="fas fa-leaf"></i> Mode Efisiensi Biaya</h3>
          <p>Gunakan alternatif hemat tanpa korbankan keselamatan struktural.</p>
          <label class="toggle">
            <input type="checkbox" id="hemat-mode">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div id="tukang-tab" class="tab-content">
        <!-- Tukang -->
        <div class="section">
          <h2><i class="fas fa-users"></i> Manajemen Tukang</h2>
          <div id="tukang-list">
            <div class="tukang-row">
              <input type="text" placeholder="Nama Tukang" class="tukang-nama">
              <div class="input-group">
                <span class="input-prefix">Rp</span>
                <input type="text" placeholder="Upah/Hari" class="tukang-upah input-with-prefix" value="150000" oninput="formatRupiah(this)">
              </div>
              <input type="number" placeholder="Hari Kerja" class="tukang-hari" value="15">
              <button class="btn-remove" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <button class="btn-add" onclick="addTukang()">
            <i class="fas fa-plus"></i> Tambah Tukang
          </button>
        </div>
      </div>

      <div id="pengeluaran-tab" class="tab-content">
        <!-- Pengeluaran Aktual -->
        <div class="section">
          <h2><i class="fas fa-money-bill-wave"></i> Manajemen Pengeluaran Aktual</h2>
          
          <!-- Ringkasan Pengeluaran -->
          <div class="expense-summary">
            <div class="summary-item">
              <h4>Anggaran Total</h4>
              <p id="budget-total">Rp 0</p>
            </div>
            <div class="summary-item">
              <h4>Terpakai</h4>
              <p id="expense-used" class="negative">Rp 0</p>
            </div>
            <div class="summary-item">
              <h4>Sisa Anggaran</h4>
              <p id="budget-remaining" class="positive">Rp 0</p>
            </div>
          </div>
          
          <!-- Filter Pengeluaran -->
          <div class="expense-filter">
            <select id="expense-category-filter">
              <option value="">Semua Kategori</option>
              <option value="material">Material</option>
              <option value="tukang">Upah Tukang</option>
              <option value="alat">Peralatan</option>
              <option value="lainnya">Lainnya</option>
            </select>
            <select id="expense-date-filter">
              <option value="">Semua Waktu</option>
              <option value="7">7 Hari Terakhir</option>
              <option value="30">30 Hari Terakhir</option>
              <option value="custom">Rentang Tanggal</option>
            </select>
          </div>
          
          <!-- Daftar Pengeluaran -->
          <div id="expense-list">
            <div class="expense-row">
              <input type="date" class="date-input" value="${new Date().toISOString().split('T')[0]}">
              <input type="text" placeholder="Deskripsi Pengeluaran" class="expense-desc">
              <div class="input-group">
                <span class="input-prefix">Rp</span>
                <input type="text" placeholder="Jumlah" class="amount-input input-with-prefix" oninput="formatRupiah(this)">
              </div>
              <select class="expense-category">
                <option value="material">Material</option>
                <option value="tukang">Upah Tukang</option>
                <option value="alat">Peralatan</option>
                <option value="lainnya">Lainnya</option>
              </select>
              <button class="btn-remove" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <button class="btn-add" onclick="addExpense()">
            <i class="fas fa-plus"></i> Tambah Pengeluaran
          </button>
          
          <!-- Grafik Pengeluaran -->
          <div class="expense-chart">
            <h3>Grafik Pengeluaran per Kategori</h3>
            <div class="chart-container">
              <canvas id="expense-chart-canvas"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div id="hasil-tab" class="tab-content">
        <!-- Tombol Aksi -->
        <div class="section">
          <div class="btn-group">
            <button class="btn btn-hitung" onclick="hitungEstimasi()">
              <i class="fas fa-calculator"></i> Hitung Rencana & Biaya
            </button>
            <button class="btn btn-reset" onclick="resetForm()">
              <i class="fas fa-redo"></i> Reset Semua
            </button>
            <button class="btn btn-save" onclick="exportLaporan()">
              <i class="fas fa-file-export"></i> Ekspor Laporan
            </button>
          </div>
        </div>

        <!-- Hasil -->
        <div class="section">
          <h2><i class="fas fa-chart-bar"></i> Laporan Rencana Kerja & Estimasi</h2>
          <div class="result-box" id="hasil">
            <p>Klik <strong>"Hitung Rencana & Biaya"</strong> untuk memulai perencanaan.</p>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="footer-logo">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgNPL3ZgAJz7HXpVB6-VcD0HW2TD_A4p90rfOJ-xiHwg7Y4RfIub8s0zVwnMyr3NdsECVBrK6FsJeFaVbQI60QBVFFusJtWFWkl7PtpDuJyUSPNixW9YIiWbmB599VyLQpEvL0tliJZWPdzKTWMdEpqFwOQKENZYkfW1yJDcP-Ph35zCav6Tu12r3KcVCzH/s500/HOLTON%20(1).pngg" alt="Holton Logo">
        <span style="font-weight: 700; font-size: 18px;">Holton Konstruksi</span>
      </div>
      <div class="footer-address">
        <i class="fas fa-map-marker-alt"></i> Jl. Padma Boulevard B1, Graha Padma Estate, Semarang
      </div>
      <div class="footer-contact">
        <a href="tel:+628112770199"><i class="fas fa-phone"></i> 0811-2770-199</a>
        <a href="mailto:info@holtonkonstruksi.com"><i class="fas fa-envelope"></i> info@holtonkonstruksi.com</a>
        <a href="https://www.holtonkonstruksi.com" target="_blank"><i class="fas fa-globe"></i> www.holtonkonstruksi.com</a>
      </div>
      <p style="margin-top: 15px; font-size: 12px; opacity: 0.8;">
        Â© 2025 Holton Konstruksi â€” Mitra Renovasi Terpercaya
      </p>
      <p style="font-size: 12px; opacity: 0.8;">
        <em>HoltonRenov Planner v2.1 â€¢ Simpan, Rencanakan, Eksekusi dengan Percaya Diri</em>
      </p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ========== DATABASE PEKERJAAN ==========
    const dataPekerjaan = {
      atap: { nama: "Atap / Kebocoran", per_m2: true, material: [{ nama: "Rangka galvalum", satuan: "mÂ²", harga: 150000, kebutuhan: 1 }, { nama: "Genteng beton", satuan: "bh", harga: 8000, kebutuhan: 12 }], peralatan: ["Palu", "Bor impact", "Waterpass", "Tali pengukur"], durasi: 6 },
      plumbing: { nama: "Plumbing & Saluran Air", per_m2: true, material: [{ nama: "Pipa PVC 1/2\"", satuan: "m", harga: 12000, kebutuhan: 2.5 }, { nama: "Kran air", satuan: "unit", harga: 85000, kebutuhan: 0.08 }, { nama: "Lem pipa", satuan: "tube", harga: 25000, kebutuhan: 0.1 }], peralatan: ["Kunci pipa", "Gergaji besi", "Seal tape"], durasi: 4 },
      listrik: { nama: "Kelistrikan", per_m2: true, material: [{ nama: "Kabel NYM 2x1.5 mm", satuan: "m", harga: 8000, kebutuhan: 3 }, { nama: "Stopkontak + saklar", satuan: "set", harga: 75000, kebutuhan: 0.1 }, { nama: "MCB Box", satuan: "unit", harga: 250000, kebutuhan: 0.03 }], peralatan: ["Tang potong", "Obeng set", "Tespen", "Mesin bor"], durasi: 3 },
      plafond: { nama: "Plafond", per_m2: true, material: [{ nama: "Rangka hollow 4x2", satuan: "m", harga: 10000, kebutuhan: 3 }, { nama: "Gypsum board", satuan: "mÂ²", harga: 95000, kebutuhan: 1 }, { nama: "Sekrup plafond", satuan: "bh", harga: 200, kebutuhan: 15 }], peralatan: ["Bor listrik", "Penggaris siku", "Waterpass"], durasi: 3 },
      dinding: { nama: "Dinding", per_m2: true, material: [{ nama: "Bata merah", satuan: "bh", harga: 1200, kebutuhan: 60 }, { nama: "Semen", satuan: "kg", harga: 2500, kebutuhan: 5 }, { nama: "Pasir", satuan: "mÂ³", harga: 800000, kebutuhan: 0.03 }], peralatan: ["Sendok semen", "Cangkul", "Waterpass", "Benang"], durasi: 5 },
      kusen: { nama: "Kusen & Roster", per_m2: false, material: [{ nama: "Kusen alumunium", satuan: "unit", harga: 800000, kebutuhan: 1 }, { nama: "Roster beton", satuan: "unit", harga: 150000, kebutuhan: 4 }, { nama: "Kaca bening 5mm", satuan: "mÂ²", harga: 120000, kebutuhan: 0.8 }], peralatan: ["Alat ukur laser", "Bor", "Silikon sealant"], durasi: 4 },
      lantai: { nama: "Lantai Keramik", per_m2: true, material: [{ nama: "Keramik 30x30", satuan: "mÂ²", harga: 85000, kebutuhan: 1 }, { nama: "Semen instan", satuan: "kg", harga: 5000, kebutuhan: 4 }, { nama: "Nat keramik", satuan: "kg", harga: 10000, kebutuhan: 0.5 }], peralatan: ["Palu karet", "Pemotong keramik", "Waterpass", "Spon"], durasi: 4 },
      kanopi: { nama: "Teras / Kanopi", per_m2: true, inputLuas: "luas-kanopi", material: [{ nama: "Rangka baja ringan", satuan: "mÂ²", harga: 220000, kebutuhan: 1 }, { nama: "Atap spandek", satuan: "mÂ²", harga: 95000, kebutuhan: 1.1 }, { nama: "Baut galvanis", satuan: "set", harga: 25000, kebutuhan: 1 }], peralatan: ["Bor impact", "Gergaji besi", "Meteran laser"], durasi: 3 },
      taman: { nama: "Taman", per_m2: true, inputLuas: "luas-taman", material: [{ nama: "Rumput jepang", satuan: "mÂ²", harga: 45000, kebutuhan: 1 }, { nama: "Pupuk kandang", satuan: "karung (25kg)", harga: 75000, kebutuhan: 0.05 }, { nama: "Tanaman hias", satuan: "pot", harga: 25000, kebutuhan: 0.5 }], peralatan: ["Sekop", "Gembor", "Gunting tanaman"], durasi: 2 },
      pagar: { nama: "Pagar & Gerbang", per_m2: false, inputPanjang: "panjang-pagar", material: [{ nama: "Besi hollow 4x4", satuan: "m", harga: 45000, kebutuhan: 3 }, { nama: "Cat besi anti karat", satuan: "liter", harga: 85000, kebutuhan: 0.05 }, { nama: "Semen pondasi", satuan: "sak", harga: 60000, kebutuhan: 0.2 }], peralatan: ["Mesin las", "Waterpass", "Palu", "Alat ukur"], durasi: 5 },
      cat: { nama: "Pengecatan Akhir", per_m2: true, material: [{ nama: "Cat tembok premium", satuan: "liter", harga: 120000, kebutuhan: 0.12 }, { nama: "Plamir tembok", satuan: "kg", harga: 25000, kebutuhan: 1.5 }, { nama: "Amplas halus", satuan: "lembar", harga: 2000, kebutuhan: 2 }], peralatan: ["Roller cat", "Kuas", "Wadah cat", "Masker respirator"], durasi: 4 }
    };

    const faktorLokasi = { 
      jakarta: 1.0, 
      bandung: 0.9, 
      surabaya: 0.85, 
      medan: 0.8, 
      semarang: 0.85,
      default: 0.85 
    };
    const URUTAN_PRIORITAS = ["atap", "plumbing", "listrik", "plafond", "dinding", "kusen", "lantai", "kanopi", "taman", "pagar", "cat"];

    // ========== GLOBAL VARIABLES ==========
    let expenseChart = null;
    let totalBudget = 0;

    // ========== DOM EVENTS ==========
    document.getElementById('lokasi').addEventListener('change', function() {
      document.getElementById('custom-lokasi').style.display = this.value === 'custom' ? 'block' : 'none';
    });

    document.getElementById('expense-category-filter').addEventListener('change', function() {
      filterExpenses();
    });

    document.getElementById('expense-date-filter').addEventListener('change', function() {
      filterExpenses();
    });

    // ========== FUNGSI UTILITAS ==========
    function openTab(evt, tabName) {
      var i, tabcontent, tabbuttons;
      
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
      }
      
      tabbuttons = document.getElementsByClassName("tab-button");
      for (i = 0; i < tabbuttons.length; i++) {
        tabbuttons[i].classList.remove("active");
      }
      
      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
      
      // Update chart when opening expense tab
      if (tabName === 'pengeluaran-tab') {
        updateExpenseChart();
      }
    }

    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    function showLoading() {
      document.getElementById('loading').style.display = 'flex';
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    // Format Rupiah
    function formatRupiah(input) {
      let value = input.value.replace(/[^,\d]/g, '').toString();
      let split = value.split(',');
      let sisa = split[0].length % 3;
      let rupiah = split[0].substr(0, sisa);
      let ribuan = split[0].substr(sisa).match(/\d{3}/gi);
      
      if (ribuan) {
        let separator = sisa ? '.' : '';
        rupiah += separator + ribuan.join('.');
      }
      
      rupiah = split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
      input.value = rupiah;
    }

    function unformatRupiah(value) {
      return parseInt(value.replace(/[^,\d]/g, '').toString().replace('.', ''));
    }

    function addTukang() {
      const div = document.createElement('div');
      div.className = 'tukang-row';
      div.innerHTML = `
        <input type="text" placeholder="Nama Tukang" class="tukang-nama">
        <div class="input-group">
          <span class="input-prefix">Rp</span>
          <input type="text" placeholder="Upah/Hari" class="tukang-upah input-with-prefix" value="150000" oninput="formatRupiah(this)">
        </div>
        <input type="number" placeholder="Hari Kerja" class="tukang-hari" value="10">
        <button class="btn-remove" onclick="this.parentElement.remove()">
          <i class="fas fa-times"></i>
        </button>`;
      document.getElementById('tukang-list').appendChild(div);
      showToast('Tukang berhasil ditambahkan');
    }

    function addExpense() {
      const div = document.createElement('div');
      div.className = 'expense-row';
      div.innerHTML = `
        <input type="date" class="date-input" value="${new Date().toISOString().split('T')[0]}">
        <input type="text" placeholder="Deskripsi Pengeluaran" class="expense-desc">
        <div class="input-group">
          <span class="input-prefix">Rp</span>
          <input type="text" placeholder="Jumlah" class="amount-input input-with-prefix" oninput="formatRupiah(this)">
        </div>
        <select class="expense-category">
          <option value="material">Material</option>
          <option value="tukang">Upah Tukang</option>
          <option value="alat">Peralatan</option>
          <option value="lainnya">Lainnya</option>
        </select>
        <button class="btn-remove" onclick="this.parentElement.remove(); updateExpenseSummary(); updateExpenseChart();">
          <i class="fas fa-times"></i>
        </button>`;
      document.getElementById('expense-list').appendChild(div);
      
      // Add event listeners to new inputs
      div.querySelector('.amount-input').addEventListener('input', updateExpenseSummary);
      div.querySelector('.expense-category').addEventListener('change', updateExpenseChart);
      
      showToast('Pengeluaran berhasil ditambahkan');
    }

    function updateExpenseSummary() {
      let totalExpenses = 0;
      
      document.querySelectorAll('.expense-row').forEach(row => {
        const amount = unformatRupiah(row.querySelector('.amount-input').value) || 0;
        totalExpenses += amount;
      });
      
      const remaining = totalBudget - totalExpenses;
      
      document.getElementById('budget-total').textContent = `Rp ${totalBudget.toLocaleString('id-ID')}`;
      document.getElementById('expense-used').textContent = `Rp ${totalExpenses.toLocaleString('id-ID')}`;
      document.getElementById('budget-remaining').textContent = `Rp ${remaining.toLocaleString('id-ID')}`;
      
      // Update remaining budget color
      const remainingElement = document.getElementById('budget-remaining');
      remainingElement.parentElement.className = remaining >= 0 ? 'summary-item positive' : 'summary-item negative';
    }

    function filterExpenses() {
      const categoryFilter = document.getElementById('expense-category-filter').value;
      const dateFilter = document.getElementById('expense-date-filter').value;
      const today = new Date();
      
      document.querySelectorAll('.expense-row').forEach(row => {
        let show = true;
        
        // Category filter
        if (categoryFilter && row.querySelector('.expense-category').value !== categoryFilter) {
          show = false;
        }
        
        // Date filter
        if (show && dateFilter) {
          const expenseDate = new Date(row.querySelector('.date-input').value);
          
          if (dateFilter === '7') {
            const weekAgo = new Date(today);
            weekAgo.setDate(today.getDate() - 7);
            if (expenseDate < weekAgo) show = false;
          } else if (dateFilter === '30') {
            const monthAgo = new Date(today);
            monthAgo.setDate(today.getDate() - 30);
            if (expenseDate < monthAgo) show = false;
          }
        }
        
        row.style.display = show ? 'flex' : 'none';
      });
    }

    function updateExpenseChart() {
      const categoryTotals = {
        material: 0,
        tukang: 0,
        alat: 0,
        lainnya: 0
      };
      
      document.querySelectorAll('.expense-row').forEach(row => {
        if (row.style.display === 'none') return;
        
        const category = row.querySelector('.expense-category').value;
        const amount = unformatRupiah(row.querySelector('.amount-input').value) || 0;
        categoryTotals[category] += amount;
      });
      
      const ctx = document.getElementById('expense-chart-canvas').getContext('2d');
      
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      expenseChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Material', 'Upah Tukang', 'Peralatan', 'Lainnya'],
          datasets: [{
            data: [
              categoryTotals.material,
              categoryTotals.tukang,
              categoryTotals.alat,
              categoryTotals.lainnya
            ],
            backgroundColor: [
              '#FFC107',
              '#4CAF50',
              '#2196F3',
              '#F44336'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += 'Rp ' + context.raw.toLocaleString('id-ID');
                  return label;
                }
              }
            }
          }
        }
      });
    }

    function resetForm() {
      if (confirm("âš ï¸ Hapus semua data saat ini dan reset form?")) {
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.getElementById('hasil').innerHTML = '<p>Klik <strong>"Hitung Rencana & Biaya"</strong> untuk memulai perencanaan.</p>';
        localStorage.removeItem('holton-laporan');
        showToast('Form berhasil direset');
      }
    }

    // ========== SIMPAN & MUAT PROYEK ==========
    function simpanProyek() {
      const nama = document.getElementById('nama-proyek').value.trim();
      if (!nama) {
        showToast('Masukkan nama proyek terlebih dahulu!');
        return;
      }

      // Collect expense data
      const expenses = [];
      document.querySelectorAll('.expense-row').forEach(row => {
        expenses.push({
          date: row.querySelector('.date-input').value,
          desc: row.querySelector('.expense-desc').value,
          amount: row.querySelector('.amount-input').value,
          category: row.querySelector('.expense-category').value
        });
      });

      const data = {
        nama,
        input: {
          lokasi: document.getElementById('lokasi').value,
          lokasiCustom: document.getElementById('lokasi-custom').value,
          luas: document.getElementById('luas').value,
          luasKanopi: document.getElementById('luas-kanopi').value,
          luasTaman: document.getElementById('luas-taman').value,
          panjangPagar: document.getElementById('panjang-pagar').value,
          durasi: document.getElementById('durasi').value,
          hemat: document.getElementById('hemat-mode').checked
        },
        pekerjaan: URUTAN_PRIORITAS.filter(k => document.getElementById(k)?.checked),
        tukang: Array.from(document.querySelectorAll('.tukang-row')).map(row => ({
          nama: row.querySelector('.tukang-nama').value,
          upah: unformatRupiah(row.querySelector('.tukang-upah').value),
          hari: row.querySelector('.tukang-hari').value
        })),
        expenses: expenses
      };

      const proyekLama = JSON.parse(localStorage.getItem('holton-proyek') || '{}');
      proyekLama[nama] = data;
      localStorage.setItem('holton-proyek', JSON.stringify(proyekLama));
      muatDaftarProyek();
      showToast(`âœ… Proyek "${nama}" berhasil disimpan!`);
    }

    function muatDaftarProyek() {
      const select = document.getElementById('daftar-proyek');
      select.innerHTML = '<option value="">Pilih proyek...</option>';
      const proyek = JSON.parse(localStorage.getItem('holton-proyek') || '{}');
      Object.keys(proyek).forEach(nama => {
        const opt = document.createElement('option');
        opt.value = nama;
        opt.textContent = nama;
        select.appendChild(opt);
      });
    }

    function muatProyek() {
      const nama = document.getElementById('daftar-proyek').value;
      if (!nama) {
        showToast('Pilih proyek terlebih dahulu!');
        return;
      }

      const proyek = JSON.parse(localStorage.getItem('holton-proyek') || '{}');
      const data = proyek[nama];
      if (!data) {
        showToast('Proyek tidak ditemukan!');
        return;
      }

      // Isi input
      document.getElementById('nama-proyek').value = data.nama;
      document.getElementById('lokasi').value = data.input.lokasi;
      document.getElementById('lokasi-custom').value = data.input.lokasiCustom;
      document.getElementById('custom-lokasi').style.display = data.input.lokasi === 'custom' ? 'block' : 'none';
      document.getElementById('luas').value = data.input.luas;
      document.getElementById('luas-kanopi').value = data.input.luasKanopi;
      document.getElementById('luas-taman').value = data.input.luasTaman;
      document.getElementById('panjang-pagar').value = data.input.panjangPagar;
      document.getElementById('durasi').value = data.input.durasi;
      document.getElementById('hemat-mode').checked = data.input.hemat;

      // Reset & set pekerjaan
      URUTAN_PRIORITAS.forEach(k => document.getElementById(k).checked = false);
      data.pekerjaan.forEach(k => {
        if (document.getElementById(k)) document.getElementById(k).checked = true;
      });

      // Reset & set tukang
      document.getElementById('tukang-list').innerHTML = '';
      if (data.tukang.length === 0) {
        addTukang();
      } else {
        data.tukang.forEach(t => {
          const div = document.createElement('div');
          div.className = 'tukang-row';
          div.innerHTML = `
            <input type="text" placeholder="Nama Tukang" class="tukang-nama" value="${t.nama || ''}">
            <div class="input-group">
              <span class="input-prefix">Rp</span>
              <input type="text" placeholder="Upah/Hari" class="tukang-upah input-with-prefix" value="${t.upah || 150000}" oninput="formatRupiah(this)">
            </div>
            <input type="number" placeholder="Hari Kerja" class="tukang-hari" value="${t.hari || 10}">
            <button class="btn-remove" onclick="this.parentElement.remove()">
              <i class="fas fa-times"></i>
            </button>`;
          document.getElementById('tukang-list').appendChild(div);
        });
      }

      // Reset & set expenses
      document.getElementById('expense-list').innerHTML = '';
      if (data.expenses && data.expenses.length > 0) {
        data.expenses.forEach(e => {
          const div = document.createElement('div');
          div.className = 'expense-row';
          div.innerHTML = `
            <input type="date" class="date-input" value="${e.date}">
            <input type="text" placeholder="Deskripsi Pengeluaran" class="expense-desc" value="${e.desc}">
            <div class="input-group">
              <span class="input-prefix">Rp</span>
              <input type="text" placeholder="Jumlah" class="amount-input input-with-prefix" value="${e.amount}" oninput="formatRupiah(this)">
            </div>
            <select class="expense-category">
              <option value="material" ${e.category === 'material' ? 'selected' : ''}>Material</option>
              <option value="tukang" ${e.category === 'tukang' ? 'selected' : ''}>Upah Tukang</option>
              <option value="alat" ${e.category === 'alat' ? 'selected' : ''}>Peralatan</option>
              <option value="lainnya" ${e.category === 'lainnya' ? 'selected' : ''}>Lainnya</option>
            </select>
            <button class="btn-remove" onclick="this.parentElement.remove(); updateExpenseSummary(); updateExpenseChart();">
              <i class="fas fa-times"></i>
            </button>`;
          document.getElementById('expense-list').appendChild(div);
          
          // Add event listeners to loaded inputs
          div.querySelector('.amount-input').addEventListener('input', updateExpenseSummary);
          div.querySelector('.expense-category').addEventListener('change', updateExpenseChart);
        });
      } else {
        addExpense();
      }
      
      updateExpenseSummary();
      updateExpenseChart();

      showToast(`ðŸ“‚ Proyek "${nama}" berhasil dimuat!`);
    }

    // ========== HITUNG ESTIMASI ==========
    function hitungEstimasi() {
      showLoading();
      
      setTimeout(() => {
        const lok = document.getElementById('lokasi').value;
        const faktor = faktorLokasi[lok === 'custom' ? 'default' : lok];
        const hemat = document.getElementById('hemat-mode').checked;
        const faktorHemat = hemat ? 0.85 : 1.0;
        const luas = parseFloat(document.getElementById('luas').value) || 36;
        const luasKanopi = parseFloat(document.getElementById('luas-kanopi').value) || 0;
        const luasTaman = parseFloat(document.getElementById('luas-taman').value) || 0;
        const panjangPagar = parseFloat(document.getElementById('panjang-pagar').value) || 15;
        const durasiRencana = parseInt(document.getElementById('durasi').value) || 40;

        // Aktifkan semua jika "Paket Lengkap"
        if (document.getElementById('lengkong').checked) {
          URUTAN_PRIORITAS.forEach(k => {
            if (document.getElementById(k)) document.getElementById(k).checked = true;
          });
        }

        let rincian = [];
        let peralatan = new Set();
        let totalMaterial = 0;
        let totalDurasi = 0;

        URUTAN_PRIORITAS.forEach(key => {
          if (!document.getElementById(key)?.checked) return;
          const pek = dataPekerjaan[key];
          let luasHitung = luas;
          if (pek.inputLuas) luasHitung = parseFloat(document.getElementById(pek.inputLuas).value) || 0;
          if (pek.inputPanjang) luasHitung = panjangPagar;
          if (pek.per_m2 === false && !pek.inputPanjang) luasHitung = 1;
          if (luasHitung <= 0) return;

          let totalBiaya = 0;
          let detailMat = [];
          pek.material.forEach(m => {
            const qty = m.kebutuhan * luasHitung;
            const hSat = Math.round(m.harga * faktor * faktorHemat);
            const total = Math.round(hSat * qty);
            totalBiaya += total;
            detailMat.push({ ...m, qty: parseFloat(qty.toFixed(2)), hSat, total });
          });

          totalMaterial += totalBiaya;
          totalDurasi += pek.durasi;
          rincian.push({ pekerjaan: pek.nama, biaya: totalBiaya, material: detailMat });
          pek.peralatan?.forEach(p => peralatan.add(p));
        });

        // Biaya tukang
        let totalTukang = 0;
        document.querySelectorAll('.tukang-row').forEach(row => {
          const upah = unformatRupiah(row.querySelector('.tukang-upah').value) || 0;
          const hari = parseFloat(row.querySelector('.tukang-hari').value) || 0;
          totalTukang += upah * hari;
        });

        const total = totalMaterial + totalTukang;
        totalBudget = total; // Set global budget variable
        const biayaHarian = total / durasiRencana;

        // Update expense summary with new budget
        updateExpenseSummary();

        // Skema kerja
        const skemaKerja = URUTAN_PRIORITAS
          .filter(k => document.getElementById(k)?.checked)
          .map((k, i) => `${i + 1}. ${dataPekerjaan[k].nama}`);

        // Bangun laporan dengan struktur yang benar
        let laporan = `
          <h3>ðŸ“Š Ringkasan Proyek â€” Holton Konstruksi</h3>
          <p><strong>Nama Proyek:</strong> ${document.getElementById('nama-proyek').value || 'Belum dinamai'}</p>
          <p><strong>Total Biaya Material:</strong> Rp ${totalMaterial.toLocaleString('id-ID')}</p>
          <p><strong>Total Biaya Tukang:</strong> Rp ${totalTukang.toLocaleString('id-ID')}</p>
          <p><strong>Total Estimasi:</strong> <strong>Rp ${total.toLocaleString('id-ID')}</strong></p>
          <p><strong>Durasi Teknis:</strong> ${totalDurasi} hari | <strong>Rencana:</strong> ${durasiRencana} hari</p>
          <p><strong>Alokasi Kas Harian:</strong> Â±Rp ${Math.round(biayaHarian).toLocaleString('id-ID')}/hari</p>
          ${hemat ? `<div class="highlight">âœ… Mode hemat aktif: hemat ~15% pada material non-struktural.</div>` : ''}

          <div class="progress-bar">
            <div class="progress" style="width: ${(totalDurasi/durasiRencana)*100}%"></div>
          </div>
          <p style="text-align: center; font-size: 14px; color: var(--gray);">Progress Teknis: ${Math.round((totalDurasi/durasiRencana)*100)}%</p>

          <h4>ðŸ“¦ Rincian Kebutuhan Material (Kuantitatif)</h4>
        `;

        if (rincian.length === 0) {
          laporan += "<p>Tidak ada pekerjaan dipilih.</p>";
        } else {
          rincian.forEach(r => {
            laporan += `<div class="card">
              <h3>${r.pekerjaan}</h3>
              <table><thead><tr><th>Material</th><th>Kebutuhan</th><th>Harga Satuan</th><th>Total</th></tr></thead><tbody>`;
            r.material.forEach(m => {
              laporan += `<tr>
                <td>${m.nama}</td>
                <td>${m.qty} ${m.satuan}</td>
                <td>Rp ${m.hSat.toLocaleString('id-ID')}</td>
                <td>Rp ${m.total.toLocaleString('id-ID')}</td>
              </tr>`;
            });
            laporan += `<tr><td colspan="3"><strong>Total</strong></td><td><strong>Rp ${r.biaya.toLocaleString('id-ID')}</strong></td></tr></tbody></table>
            </div>`;
          });
        }

        laporan += `
          <div class="card">
            <h3>ðŸ› ï¸ Peralatan yang Dibutuhkan</h3>
            <ul>${Array.from(peralatan).map(p => `<li>${p}</li>`).join('') || '<li>-</li>'}</ul>
          </div>

          <div class="card">
            <h3>ðŸ“… Skema Rencana Kerja (Prioritas Teknis)</h3>
            <ol>${skemaKerja.map(s => `<li>${s}</li>`).join('') || '<li>Tidak ada pekerjaan terpilih</li>'}</ol>
          </div>

          <div class="highlight-info">
            <h3>â„¹ï¸ Catatan Penting dari Holton Konstruksi</h3>
            <ul>
              <li>Harga material <strong>disesuaikan dengan lokasi</strong> dan <strong>tingkat kualitas</strong> (standar, premium, atau ekonomis). Estimasi ini menggunakan harga pasar rata-rata.</li>
              <li>Hasil perhitungan bersifat <strong>analisa kasar</strong> untuk perencanaan awal. <strong>Bukan penawaran resmi</strong>.</li>
              <li><strong>Kualitas tukang</strong> sangat memengaruhi hasil akhir, kecepatan kerja, dan efisiensi material.</li>
              <li>Faktor eksternal seperti <strong>cuaca</strong>, <strong>biaya angkut/lokal (langsiran)</strong>, ketersediaan material, dan kondisi lapangan dapat mengubah total biaya hingga Â±15%.</li>
              <li>Holton Konstruksi <strong>tidak memungut biaya tersembunyi</strong>. Semua harga disesuaikan transparan berdasarkan lokasi dan kebutuhan spesifik proyek.</li>
              <li>Alat ini dirancang untuk <strong>membantu rumah tangga yang merenovasi secara mandiri</strong> sebagai panduan pengendali arah anggaran dan jadwal.</li>
              <li>Jika mengalami kesulitan dalam perencanaan atau eksekusi, jangan ragu untuk konsultasi langsung dengan tim ahli kami.</li>
            </ul>
            <p style="margin-top:12px; font-weight:bold; color: var(--primary);">
              ðŸ“ž <strong>Konsultasi Gratis:</strong> Hubungi Holton Konstruksi via Call/WhatsApp: 
              <a href="https://wa.me/628112770199" target="_blank">0811-2770-199</a>
            </p>
          </div>

          <p><em>Dibuat dengan HoltonRenov Planner â€” Holton Konstruksi â€¢ ${new Date().toLocaleDateString('id-ID')}</em></p>
        `;

        document.getElementById('hasil').innerHTML = laporan;
        localStorage.setItem('holton-laporan', laporan);
        
        hideLoading();
        showToast('Perhitungan estimasi selesai!');
        
        // Buka tab hasil
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.querySelector('[onclick*="hasil-tab"]').classList.add('active');
        document.getElementById('hasil-tab').classList.add('active');
      }, 1000);
    }

    // ========== EKSPOR LAPORAN ==========
    function exportLaporan() {
      const laporan = localStorage.getItem('holton-laporan');
      if (!laporan) {
        showToast('Hitung estimasi terlebih dahulu!');
        return;
      }

      const namaProyek = document.getElementById('nama-proyek').value.trim() || 'laporan_renovasi';
      const safeName = namaProyek.replace(/[^a-z0-9]/gi, '_').toLowerCase();
      
      // Get expense data for the report
      const expenses = [];
      document.querySelectorAll('.expense-row').forEach(row => {
        expenses.push({
          date: row.querySelector('.date-input').value,
          desc: row.querySelector('.expense-desc').value,
          amount: row.querySelector('.amount-input').value,
          category: row.querySelector('.expense-category').value
        });
      });
      
      // Calculate expense totals by category
      const expenseTotals = {
        material: 0,
        tukang: 0,
        alat: 0,
        lainnya: 0
      };
      
      expenses.forEach(e => {
        const amount = unformatRupiah(e.amount) || 0;
        expenseTotals[e.category] += amount;
      });
      
      // Create expense summary table
      let expenseTable = `
        <div class="card">
          <h3>ðŸ’° Ringkasan Pengeluaran Aktual</h3>
          <table>
            <thead>
              <tr>
                <th>Kategori</th>
                <th>Jumlah</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Material</td>
                <td>Rp ${expenseTotals.material.toLocaleString('id-ID')}</td>
              </tr>
              <tr>
                <td>Upah Tukang</td>
                <td>Rp ${expenseTotals.tukang.toLocaleString('id-ID')}</td>
              </tr>
              <tr>
                <td>Peralatan</td>
                <td>Rp ${expenseTotals.alat.toLocaleString('id-ID')}</td>
              </tr>
              <tr>
                <td>Lainnya</td>
                <td>Rp ${expenseTotals.lainnya.toLocaleString('id-ID')}</td>
              </tr>
              <tr>
                <td><strong>Total Pengeluaran</strong></td>
                <td><strong>Rp ${(expenseTotals.material + expenseTotals.tukang + expenseTotals.alat + expenseTotals.lainnya).toLocaleString('id-ID')}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="card">
          <h3>ðŸ“‹ Detail Pengeluaran</h3>
          <table>
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Deskripsi</th>
                <th>Kategori</th>
                <th>Jumlah</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      expenses.forEach(e => {
        expenseTable += `
          <tr>
            <td>${e.date}</td>
            <td>${e.desc}</td>
            <td>${e.category.charAt(0).toUpperCase() + e.category.slice(1)}</td>
            <td>Rp ${unformatRupiah(e.amount).toLocaleString('id-ID')}</td>
          </tr>
        `;
      });
      
      expenseTable += `
            </tbody>
          </table>
        </div>
      `;
      
      const fullHtml = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Laporan - ${namaProyek}</title>
          <style>
            body { 
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
              padding: 25px; 
              line-height: 1.6; 
              background: #f9fbfd; 
              color: #212121;
            }
            .container { 
              max-width: 1000px; 
              margin: 0 auto; 
              background: white; 
              padding: 25px; 
              border-radius: 10px; 
              box-shadow: 0 0 10px rgba(0,0,0,0.1);
              position: relative;
            }
            .container::before {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              width: 8px;
              height: 100%;
              background: #FFC107;
            }
            h1, h2, h3, h4 { 
              color: #212121; 
              font-weight: 600;
            }
            h1 {
              font-size: 28px;
              display: flex;
              align-items: center;
            }
            h1 i {
              margin-right: 15px;
              color: #FFC107;
            }
            h2 {
              font-size: 22px;
              margin-top: 25px;
              padding-bottom: 10px;
              border-bottom: 1px solid #f5f5f5;
            }
            h3 {
              font-size: 18px;
              margin-top: 20px;
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin: 15px 0; 
            }
            th, td { 
              border: 1px solid #ddd; 
              padding: 12px; 
              text-align: left; 
            }
            th { 
              background-color: #f5f5f5; 
              color: #212121;
              font-weight: 600;
            }
            ul { 
              padding-left: 25px; 
            }
            .highlight-info { 
              background: #e8f4fc; 
              padding: 20px; 
              border-radius: 8px; 
              margin: 20px 0; 
              border-left: 4px solid #FFC107;
            }
            .card {
              background: #ffffff;
              border-radius: 8px;
              padding: 20px;
              margin-bottom: 20px;
              box-shadow: 0 2px 10px rgba(0,0,0,0.05);
              border-left: 4px solid #FFC107;
            }
            .progress-bar {
              width: 100%;
              height: 8px;
              background: #f5f5f5;
              border-radius: 4px;
              margin: 15px 0;
              overflow: hidden;
            }
            .progress {
              height: 100%;
              background: #FFC107;
            }
            a { 
              color: #FFC107; 
              text-decoration: none;
              font-weight: 500;
            }
            a:hover {
              text-decoration: underline;
            }
            @media print {
              body { padding: 0; }
              .container { box-shadow: none; }
            }
          </style>
        </head>
        <body>
          <div class="container">
            <h1><i class="fas fa-file-export"></i> Laporan Renovasi â€” Holton Konstruksi</h1>
            ${laporan}
            ${expenseTable}
          </div>
        </body>
        </html>
      `;

      const blob = new Blob([fullHtml], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `holtonrenov_${safeName}.html`;
      a.click();
      
      showToast(`Laporan "${namaProyek}" berhasil diekspor!`);
    }

    // ========== INIT ==========
    muatDaftarProyek();
    addExpense();
    updateExpenseSummary();
    updateExpenseChart();
  </script>
</body>
</html>
